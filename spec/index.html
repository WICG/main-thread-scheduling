<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Prioritized Task Scheduling</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version b94c7e755, updated Fri Feb 19 16:28:59 2021 -0800" name="generator">
  <link href="https://wicg.github.io/prioritized-task-scheduling/ **TODO(shaseley)**: Fix this." rel="canonical">
  <meta content="9a601fc43e8fa6d25cb3b7c3d72819a69e273b09" name="document-revision">
<style>
  /*
   * This is in bikeshed’s stylesheet.include, but not in W3C’s base.css. And
   * since stylesheet.include is not longer inlined when we link to it, this
   * is omitted.
   * 
   * The culprit might be:
   * https://github.com/tabatkins/bikeshed/commit/90652a820d408493d429e471a35a9c4a628d9f60
   */

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Prioritized Task Scheduling</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="2021-03-08">8 March 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/prioritized-task-scheduling/ **TODO(shaseley)**: Fix this.">https://wicg.github.io/prioritized-task-scheduling/ <strong>TODO(shaseley)</strong>: Fix this.</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/wicg/scheduling-apis/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:shaseley@google.com">Scott Haseley</a> (<a class="p-org org" href="https://google.com/">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 the Contributors to the Prioritized Task Scheduling Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>A short description of your spec, one or two sentences. <strong>TODO</strong>(shaseley): Fill this in.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#sec-task-priorities"><span class="secno">2</span> <span class="content">Task Priorities</span></a>
    <li>
     <a href="#sec-api"><span class="secno">3</span> <span class="content">API</span></a>
     <ol class="toc">
      <li><a href="#sec-api-scheduling-tasks"><span class="secno">3.1</span> <span class="content">Scheduling Tasks</span></a>
      <li>
       <a href="#sec-api-controlling-tasks"><span class="secno">3.2</span> <span class="content">Controlling Tasks</span></a>
       <ol class="toc">
        <li><a href="#sec-api-task-controller"><span class="secno">3.2.1</span> <span class="content">TaskController</span></a>
        <li><a href="#sec-api-task-signal"><span class="secno">3.2.2</span> <span class="content">TaskSignal</span></a>
       </ol>
      <li><a href="#sec-usage-examples"><span class="secno">3.3</span> <span class="content">Usage Examples</span></a>
     </ol>
    <li>
     <a href="#sec-data-model"><span class="secno">4</span> <span class="content">Data Model</span></a>
     <ol class="toc">
      <li><a href="#sec-dm-scheduler-tasks"><span class="secno">4.1</span> <span class="content">Scheduler Tasks</span></a>
      <li><a href="#sec-dm-scheduler-task-queues"><span class="secno">4.2</span> <span class="content">Scheduler Task Queues</span></a>
      <li><a href="#sec-dm-scheduler"><span class="secno">4.3</span> <span class="content">Scheduler</span></a>
     </ol>
    <li>
     <a href="#sec-processing-model"><span class="secno">5</span> <span class="content">Processing Model</span></a>
     <ol class="toc">
      <li><a href="#sec-scheduler-task-sources"><span class="secno">5.1</span> <span class="content">Scheduler Task Sources</span></a>
      <li><a href="#sec-scheduler-task-algorithms"><span class="secno">5.2</span> <span class="content">Scheduler Task Algorithms</span></a>
      <li><a href="#sec-scheduler-task-queue-algorithms"><span class="secno">5.3</span> <span class="content">Scheduler Task Queue Algorithms</span></a>
      <li>
       <a href="#sec-scheduler-algorithms"><span class="secno">5.4</span> <span class="content">Scheduler Algorithms</span></a>
       <ol class="toc">
        <li><a href="#sec-scheduler-alg-selecting-tq"><span class="secno">5.4.1</span> <span class="content">Selecting the Task Queue</span></a>
        <li><a href="#sec-scheduler-alg-scheduling-tasks"><span class="secno">5.4.2</span> <span class="content">Scheduling Tasks</span></a>
        <li><a href="#sec-scheduler-alg-select-next-task"><span class="secno">5.4.3</span> <span class="content">Selecting the Next Task To Run</span></a>
       </ol>
      <li>
       <a href="#sec-patches-html"><span class="secno">5.5</span> <span class="content">Modifications to the HTML Standard</span></a>
       <ol class="toc">
        <li><a href="#sec-patches-html-windoworworkerglobalscope"><span class="secno">5.5.1</span> <span class="content"><code>WindowOrWorkerGlobalScope</code></span></a>
        <li><a href="#html-html-event-loop-definitions"><span class="secno">5.5.2</span> <span class="content"><span>Event loop: definitions</span></span></a>
        <li><a href="#html-event-loop"><span class="secno">5.5.3</span> <span class="content"><span>Event loop: processing model</span></span></a>
       </ol>
     </ol>
    <li><a href="#sec-security"><span class="secno">6</span> <span class="content">Security and Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><strong>TODO</strong>(shaseley): Fill this in.</p>
   <h2 class="heading settled" data-level="2" id="sec-task-priorities"><span class="secno">2. </span><span class="content">Task Priorities</span><a class="self-link" href="#sec-task-priorities"></a></h2>
   <p>This spec formalizes three priorities to support scheduling tasks:</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export id="dom-taskpriority-user-blocking"><code><c- s>"user-blocking"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export id="dom-taskpriority-user-visible"><code><c- s>"user-visible"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export id="dom-taskpriority-background"><code><c- s>"background"</c-></code></dfn>
};
</pre>
   <p><code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking">user-blocking</a></code> is the highest priority, and is meant to be used
for tasks that are blocking the user’s ability to interact with the page, such
as rendering the core experience or responding to user input.</p>
   <p><code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible">user-visible</a></code> is the second highest priority, and is meant to
be used for tasks that visible to the user but not necessarily blocking user
actions, such as rendering secondary parts of the page. This is the default
priority.</p>
   <p><code class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background">background</a></code> is the lowest priority, and is meant to be used for
tasks that are not time-critical, such as background log processing or
initializing certain third party libraries.</p>
   <p class="note" role="note"><span>Note:</span> Tasks scheduled through a given <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler">Scheduler</a></code> run in <em>strict priority
order</em>, meaning the scheduler will always run <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking①">user-blocking</a></code> tasks before <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible①">user-visible</a></code> tasks, which in turn always run
before <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background①">background</a></code> tasks.</p>
   <div class="algorithm" data-algorithm="greater than" data-algorithm-for="TaskPriority">
     <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority">TaskPriority</a></code> <var>priority1</var> is <dfn class="dfn-paneled" data-dfn-for="TaskPriority" data-dfn-type="dfn" data-noexport id="taskpriority-greater-than">greater than</dfn> <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①">TaskPriority</a></code> <var>priority2</var> if the following steps return true: 
    <ol>
     <li data-md>
      <p>Let <var>priorities</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> «[ <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking②">user-blocking</a></code> → 2, <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible②">user-visible</a></code> → 1, <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background②">background</a></code> → 0 ]».</p>
     <li data-md>
      <p>Return true if <var>priorities</var>[<var>priority1</var>] is greater than <var>priorities</var>[<var>priority2</var>], otherwise false.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="3" id="sec-api"><span class="secno">3. </span><span class="content">API</span><a class="self-link" href="#sec-api"></a></h2>
   <p><strong>TODO</strong>(shaseley): Add an intro sentence here.</p>
   <h3 class="heading settled" data-level="3.1" id="sec-api-scheduling-tasks"><span class="secno">3.1. </span><span class="content">Scheduling Tasks</span><a class="self-link" href="#sec-api-scheduling-tasks"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></dfn> {
    (<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#tasksignal" id="ref-for-tasksignal"><c- n>TaskSignal</c-></a>)? <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="(AbortSignal or TaskSignal)? " id="dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></dfn> = <c- b>null</c->;
    <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②"><c- n>TaskPriority</c-></a>? <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="TaskPriority? " id="dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></dfn> = <c- b>null</c->;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="long " id="dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></dfn> = 0;
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="scheduler"><code><c- g>Scheduler</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback" id="ref-for-callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <dfn class="idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-scheduler-posttask-callback-options-callback"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions" id="ref-for-dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <dfn class="idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-scheduler-posttask-callback-options-options"></a></dfn> = {});
};
</pre>
   <p class="issue" id="issue-5c5aa461"><a class="self-link" href="#issue-5c5aa461"></a> Is that the right way to define signal?</p>
   <h3 class="heading settled" data-level="3.2" id="sec-api-controlling-tasks"><span class="secno">3.2. </span><span class="content">Controlling Tasks</span><a class="self-link" href="#sec-api-controlling-tasks"></a></h3>
   <h4 class="heading settled" data-level="3.2.1" id="sec-api-task-controller"><span class="secno">3.2.1. </span><span class="content">TaskController</span><a class="self-link" href="#sec-api-task-controller"></a></h4>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)] <c- b>interface</c-> <dfn class="idl-code" data-dfn-type="interface" data-export id="taskcontroller"><code><c- g>TaskController</c-></code><a class="self-link" href="#taskcontroller"></a></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller"><c- n>AbortController</c-></a> {
  <dfn class="idl-code" data-dfn-for="TaskController" data-dfn-type="constructor" data-export data-lt="TaskController(priority)|constructor(priority)|TaskController()|constructor()" id="dom-taskcontroller-taskcontroller"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-taskcontroller-taskcontroller"></a></dfn>(<c- b>optional</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority③"><c- n>TaskPriority</c-></a> <dfn class="idl-code" data-dfn-for="TaskController/TaskController(priority), TaskController/constructor(priority), TaskController/TaskController(), TaskController/constructor()" data-dfn-type="argument" data-export id="dom-taskcontroller-taskcontroller-priority-priority"><code><c- g>priority</c-></code><a class="self-link" href="#dom-taskcontroller-taskcontroller-priority-priority"></a></dfn> = "user-visible");
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <dfn class="idl-code" data-dfn-for="TaskController" data-dfn-type="method" data-export data-lt="setPriority(priority)" id="dom-taskcontroller-setpriority"><code><c- g>setPriority</c-></code><a class="self-link" href="#dom-taskcontroller-setpriority"></a></dfn>(<a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority④"><c- n>TaskPriority</c-></a> <dfn class="idl-code" data-dfn-for="TaskController/setPriority(priority)" data-dfn-type="argument" data-export id="dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code><a class="self-link" href="#dom-taskcontroller-setpriority-priority-priority"></a></dfn>);
};
</pre>
   <h4 class="heading settled" data-level="3.2.2" id="sec-api-task-signal"><span class="secno">3.2.2. </span><span class="content">TaskSignal</span><a class="self-link" href="#sec-api-task-signal"></a></h4>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="tasksignal"><code><c- g>TaskSignal</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①"><c- n>AbortSignal</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑤"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export data-readonly data-type="TaskPriority" id="dom-tasksignal-priority"><code><c- g>priority</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-tasksignal-onprioritychange"><code><c- g>onprioritychange</c-></code><a class="self-link" href="#dom-tasksignal-onprioritychange"></a></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="3.3" id="sec-usage-examples"><span class="secno">3.3. </span><span class="content">Usage Examples</span><a class="self-link" href="#sec-usage-examples"></a></h3>
   <p><strong>TODO</strong>(shaseley): Fill this in.</p>
   <h2 class="heading settled" data-level="4" id="sec-data-model"><span class="secno">4. </span><span class="content">Data Model</span><a class="self-link" href="#sec-data-model"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="sec-dm-scheduler-tasks"><span class="secno">4.1. </span><span class="content">Scheduler Tasks</span><a class="self-link" href="#sec-dm-scheduler-tasks"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task">scheduler task</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task">task</a> with an additional numeric <dfn class="dfn-paneled" data-dfn-for="scheduler task" data-dfn-type="dfn" data-noexport id="scheduler-task-enqueue-order">enqueue order</dfn> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">item</a>, initially set to 0.</p>
   <h3 class="heading settled" data-level="4.2" id="sec-dm-scheduler-task-queues"><span class="secno">4.2. </span><span class="content">Scheduler Task Queues</span><a class="self-link" href="#sec-dm-scheduler-task-queues"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-queue">scheduler task queue</dfn> is formally a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">items</a>:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-priority">priority</dfn>
    <dd data-md>
     <p>A <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑥">TaskPriority</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-tasks">tasks</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task">scheduler tasks</a>.</p>
   </dl>
   <h3 class="heading settled" data-level="4.3" id="sec-dm-scheduler"><span class="secno">4.3. </span><span class="content">Scheduler</span><a class="self-link" href="#sec-dm-scheduler"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①">Scheduler</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="static priority task queue map" data-noexport id="scheduler-static-priority-task-queue-map">static priority
task queue map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue">scheduler task queues</a> indexed
by <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑦">TaskPriority</a></code>. This map is empty unless otherwise stated.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②">Scheduler</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="dynamic priority task queue map" data-noexport id="scheduler-dynamic-priority-task-queue-map">dynamic priority
task queue map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> of <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①">scheduler task queues</a> indexed
by <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①">TaskSignal</a></code>. This map is empty unless otherwise stated.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler③">Scheduler</a></code> object has a numeric <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="next enqueue order" data-noexport id="scheduler-next-enqueue-order">next enqueue
order</dfn> which is initialized to 1.</p>
   <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order">next enqueue order</a> is a strictly increasing number that
is used to determine task execution order across <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue②">scheduler task queues</a> of the
same <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑧">TaskPriority</a></code> within the same <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler④">Scheduler</a></code>. A logically equivalent
alternative would be to place the <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order①">next enqueue order</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a>, since the only requirements are that the number be strictly
increasing and never used more than once within a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑤">Scheduler</a></code>.</p>
   <h2 class="heading settled" data-level="5" id="sec-processing-model"><span class="secno">5. </span><span class="content">Processing Model</span><a class="self-link" href="#sec-processing-model"></a></h2>
   <p><strong>TODO</strong>(shaseley): Add an intro sentence here.</p>
   <h3 class="heading settled" data-level="5.1" id="sec-scheduler-task-sources"><span class="secno">5.1. </span><span class="content">Scheduler Task Sources</span><a class="self-link" href="#sec-scheduler-task-sources"></a></h3>
   <p>The following <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task sources</a> are defined as <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-sources">scheduler task sources</dfn>,
and must only be used for <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task①">scheduler tasks</a>.</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="the-posted-task-task-source">The posted task task source</dfn>
    <dd data-md>
     <p>This <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a> is used for tasks scheduled through <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask①">postTask()</a></code>.</p>
   </dl>
   <h3 class="heading settled" data-level="5.2" id="sec-scheduler-task-algorithms"><span class="secno">5.2. </span><span class="content">Scheduler Task Algorithms</span><a class="self-link" href="#sec-scheduler-task-algorithms"></a></h3>
   <div class="algorithm" data-algorithm="older than" data-algorithm-for="scheduler task"> A <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task②">scheduler task</a> <var>t1</var> is <dfn class="dfn-paneled" data-dfn-for="scheduler task" data-dfn-type="dfn" data-noexport id="scheduler-task-older-than">older than</dfn> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task③">scheduler task</a> <var>t2</var> if <var>t1</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order">enqueue order</a> less than <var>t2</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order①">enqueue order</a>. </div>
   <h3 class="heading settled" data-level="5.3" id="sec-scheduler-task-queue-algorithms"><span class="secno">5.3. </span><span class="content">Scheduler Task Queue Algorithms</span><a class="self-link" href="#sec-scheduler-task-queue-algorithms"></a></h3>
   <div class="algorithm" data-algorithm="create a scheduler task queue">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="create a scheduler task queue|creating a scheduler task queue" data-noexport id="create-a-scheduler-task-queue">create a scheduler task queue</dfn> with <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑨">TaskPriority</a></code> <var>priority</var>: 
    <ol>
     <li data-md>
      <p>Let <var>queue</var> be a new <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue③">scheduler task queue</a>.</p>
     <li data-md>
      <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority">priority</a> to <var>priority</var>.</p>
     <li data-md>
      <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks">tasks</a> to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a>.</p>
     <li data-md>
      <p>Return <var>queue</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="queue a scheduler task">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="queue a scheduler task|queuing a scheduler task" data-noexport id="queue-a-scheduler-task">queue a scheduler task</dfn> on a <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue④">scheduler task queue</a> <var>queue</var>,
  which performs a series of steps <var>steps</var>, given a numeric <var>enqueue order</var>, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source②">task source</a> <var>source</var>, and a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> <var>document</var>: 
    <ol>
     <li data-md>
      <p>Let <var>task</var> be a new <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task④">scheduler task</a>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order②">enqueue order</a> to <var>enqueue order</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps" id="ref-for-concept-task-steps">steps</a> to <var>steps</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-source" id="ref-for-concept-source">source</a> to <var>source</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-document" id="ref-for-concept-document①">document</a> to <var>document</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a> to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">set</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">append</a> <var>task</var> to <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks①">tasks</a>.</p>
     <li data-md>
      <p>Return <var>task</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-78a65b9e"><a class="self-link" href="#issue-78a65b9e"></a> Should we refactor the event loop task creation code and remove the duplicatation?</p>
   <div class="algorithm" data-algorithm="remove" data-algorithm-for="scheduler task queue"> To <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-remove">remove</dfn> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑤">scheduler task</a> <var>task</var> from <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑤">scheduler task queue</a> <var>queue</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">remove</a> <var>task</var> from <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks②">tasks</a>. </div>
   <h3 class="heading settled" data-level="5.4" id="sec-scheduler-algorithms"><span class="secno">5.4. </span><span class="content">Scheduler Algorithms</span><a class="self-link" href="#sec-scheduler-algorithms"></a></h3>
   <h4 class="heading settled" data-level="5.4.1" id="sec-scheduler-alg-selecting-tq"><span class="secno">5.4.1. </span><span class="content">Selecting the Task Queue</span><a class="self-link" href="#sec-scheduler-alg-selecting-tq"></a></h4>
   <div class="algorithm" data-algorithm="select the scheduler task queue">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="select the scheduler task queue|selecting the scheduler task queue" data-noexport id="select-the-scheduler-task-queue">select the scheduler task queue</dfn> for a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑥">Scheduler</a></code> <var>scheduler</var> given (<code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②">TaskSignal</a></code> or <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal②">AbortSignal</a></code>) <var>signal</var>, and a <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⓪">TaskPriority</a></code> <var>priority</var>: 
    <ol>
     <li data-md>
      <p>If <var>priority</var> is null and <var>signal</var> is not null and <var>signal</var> is a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③">TaskSignal</a></code>, then</p>
      <ol>
       <li data-md>
        <p>If <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map">dynamic priority task queue map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contain</a> <var>signal</var>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#create-a-scheduler-task-queue" id="ref-for-create-a-scheduler-task-queue">creating a scheduler task queue</a> given <var>signal</var>’s <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority">priority</a></code>.</p>
         <li data-md>
          <p>Set <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map①">dynamic priority task queue map</a>[<var>signal</var>] to <var>queue</var>.</p>
         <li data-md>
          <p>Add the following priority change steps to <var>signal</var>:</p>
          <ol>
           <li data-md>
            <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority①">priority</a> to <var>signal</var>’s <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority①">priority</a></code>.</p>
          </ol>
        </ol>
       <li data-md>
        <p>Return <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map②">dynamic priority task queue map</a>[<var>signal</var>].</p>
      </ol>
     <li data-md>
      <p>Otherwise</p>
      <ol>
       <li data-md>
        <p>If <var>priority</var> is null, set <var>priority</var> to <code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible③">user-visible</a></code>.</p>
       <li data-md>
        <p>If <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map">static priority task queue map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">contain</a> <var>priority</var>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#create-a-scheduler-task-queue" id="ref-for-create-a-scheduler-task-queue①">creating a scheduler task queue</a> given <var>priority</var>.</p>
         <li data-md>
          <p>Set <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map①">static priority task queue map</a>[<var>priority</var>] to <var>queue</var>.</p>
        </ol>
       <li data-md>
        <p>Return <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map②">static priority task queue map</a>[<var>priority</var>].</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-75aafb43"><a class="self-link" href="#issue-75aafb43"></a> Link the priority change algorithm.</p>
   <h4 class="heading settled" data-level="5.4.2" id="sec-scheduler-alg-scheduling-tasks"><span class="secno">5.4.2. </span><span class="content">Scheduling Tasks</span><a class="self-link" href="#sec-scheduler-alg-scheduling-tasks"></a></h4>
   <div class="algorithm" data-algorithm="postTask(callback, options)" data-algorithm-for="Scheduler">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler" data-dfn-type="method" data-export data-lt="postTask(callback, options)|postTask(callback)" id="dom-scheduler-posttask" optionsU00029 title="postTask(callback,"><code>postTask(<var>callback</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>p</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>signal</var> be null.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal">signal</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exists</a>, then set <var>signal</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal①">signal</a></code>"].</p>
     <li data-md>
      <p>If <var>signal</var> is not null and its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag" id="ref-for-abortsignal-aborted-flag">aborted flag</a> is set, then return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> an "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>priority</var> be null.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority">priority</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exists</a>, then set <var>priority</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority①">priority</a></code>"].</p>
     <li data-md>
      <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#select-the-scheduler-task-queue" id="ref-for-select-the-scheduler-task-queue">selecting the scheduler task queue</a> for <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a> given <var>signal</var> and <var>priority</var>.</p>
     <li data-md>
      <p>Let <var>delay</var> be 0.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay">delay</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exists</a>, then set <var>delay</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay①">delay</a></code>"].</p>
     <li data-md>
      <p>If <var>delay</var> is less than 0 then set <var>delay</var> to 0.</p>
     <li data-md>
      <p>If <var>delay</var> is equal to 0 then</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#schedule-a-task-to-invoke-a-callback" id="ref-for-schedule-a-task-to-invoke-a-callback">schedule a task to invoke a callback</a> for <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this</a> given <var>queue</var>, <var>signal</var>, <var>callback</var>, and <var>p</var>.</p>
       <li data-md>
        <p>Return p.</p>
      </ol>
     <li data-md>
      <p>Otherwise, return <var>p</var> and continue running this algorithm <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>.</p>
     <li data-md>
      <p><strong>TODO</strong>(shaseley): Define waiting, potentially refactoring the timer spec.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#schedule-a-task-to-invoke-a-callback" id="ref-for-schedule-a-task-to-invoke-a-callback①">schedule a task to invoke a callback</a> for <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a> given <var>queue</var>, <var>signal</var>, <var>callback</var>, and <var>p</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="schedule a task to invoke a callback">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="schedule-a-task-to-invoke-a-callback">schedule a task to invoke a callback</dfn> for <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑦">Scheduler</a></code> <var>scheduler</var> given a <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑥">scheduler task queue</a> <var>queue</var>, an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal③">AbortSignal</a></code> <var>signal</var>,
  SchedulerPostTaskCallback <var>callback</var>, and promise <var>task result promise</var>: 
    <ol>
     <li data-md>
      <p>Let <var>global</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> for <var>scheduler</var>.</p>
     <li data-md>
      <p>Let <var>document</var> be <var>global</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window">associated <code>Document</code></a> if <var>global</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object; otherwise null.</p>
     <li data-md>
      <p>Let <var>enqueue order</var> be <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order②">next enqueue order</a>.</p>
     <li data-md>
      <p>Increment <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order③">next enqueue order</a> by 1.</p>
     <li data-md>
      <p>Let <var>task</var> be the result of <a data-link-type="dfn" href="#queue-a-scheduler-task" id="ref-for-queue-a-scheduler-task">queuing a scheduler task</a> on <var>queue</var> given <var>enqueue order</var>, <a data-link-type="dfn" href="#the-posted-task-task-source" id="ref-for-the-posted-task-task-source">the posted task task source</a>, and <var>document</var>, and that performs the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>result</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">invoking</a> <var>callback</var>. If that threw an exception, then reject <var>task result promise</var> with that, otherwise resolve <var>task result promise</var> with <var>result</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>signal</var> is not null, then <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">add the following</a> abort steps to it:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#scheduler-task-queue-remove" id="ref-for-scheduler-task-queue-remove">remove</a> <var>task</var> from <var>queue</var>.</p>
       <li data-md>
        <p>Reject <var>task result promise</var> with an "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror①">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-4bae1ee2"><a class="self-link" href="#issue-4bae1ee2"></a> Parts of this need to be atomic, but how do we do that?</p>
   </div>
   <h4 class="heading settled" data-level="5.4.3" id="sec-scheduler-alg-select-next-task"><span class="secno">5.4.3. </span><span class="content">Selecting the Next Task To Run</span><a class="self-link" href="#sec-scheduler-alg-select-next-task"></a></h4>
   <div class="algorithm" data-algorithm="get the runnable task queues">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="get the runnable task queues|getting the runnable task queues" data-noexport id="get-the-runnable-task-queues">get the runnable task queues</dfn> for a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑧">Scheduler</a></code> <var>scheduler</var>, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>queues</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values">getting the values</a> <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map③">static priority task queue map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-extend" id="ref-for-list-extend">extend</a> <var>queues</var> with the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values①">getting the values</a> of <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map③">dynamic priority task queue map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">remove</a> from <var>queues</var> any <var>queue</var> such that <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks③">tasks</a> do not contain a <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable">runnable</a> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑥">scheduler task</a>.</p>
     <li data-md>
      <p>Return <var>queues</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="has a runnable task"> A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑨">Scheduler</a></code> <var>scheduler</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="has a runnable task|have a runnable task" data-noexport id="has-a-runnable-task">has a runnable task</dfn> if the result of <a data-link-type="dfn" href="#get-the-runnable-task-queues" id="ref-for-get-the-runnable-task-queues">getting the runnable task queues</a> for <var>scheduler</var> is non-<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a>. </div>
   <div class="algorithm" data-algorithm="select the task queue of the next scheduler task">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="select the task queue of the next scheduler task |selecting the task queue of the next scheduler task" data-noexport id="select-the-task-queue-of-the-next-scheduler-task">select the task queue of the next scheduler task</dfn> for a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⓪">Scheduler</a></code> <var>scheduler</var>: 
    <ol>
     <li data-md>
      <p>Let <var>queues</var> be the result of <a data-link-type="dfn" href="#get-the-runnable-task-queues" id="ref-for-get-the-runnable-task-queues①">getting the runnable task queues</a> for <var>scheduler</var>.</p>
     <li data-md>
      <p>Let <var>candidate task</var> be null.</p>
     <li data-md>
      <p>Let <var>candidate queue</var> be null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>queue</var> of <var>queues</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>task</var> be the first <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable①">runnable</a> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑦">scheduler task</a> in <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks④">tasks</a>.</p>
       <li data-md>
        <p>If <var>candidate task</var> is null, or  if <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority②">priority</a> is <a data-link-type="dfn" href="#taskpriority-greater-than" id="ref-for-taskpriority-greater-than">greater than</a> <var>candidate queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority③">priority</a>, or if (<var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority④">priority</a> equals <var>candidate queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority⑤">priority</a> and <var>task</var> is <a data-link-type="dfn" href="#scheduler-task-older-than" id="ref-for-scheduler-task-older-than">older than</a> <var>candidate task</var>) then</p>
        <ol>
         <li data-md>
          <p>Set <var>candidate task</var> to <var>task</var>.</p>
         <li data-md>
          <p>Set <var>candidate queue</var> to <var>queue</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>candidate queue</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.5" id="sec-patches-html"><span class="secno">5.5. </span><span class="content">Modifications to the HTML Standard</span><a class="self-link" href="#sec-patches-html"></a></h3>
   <h4 class="heading settled" data-level="5.5.1" id="sec-patches-html-windoworworkerglobalscope"><span class="secno">5.5.1. </span><span class="content"><code>WindowOrWorkerGlobalScope</code></span><a class="self-link" href="#sec-patches-html-windoworworkerglobalscope"></a></h4>
   <p>Each object implementing the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code> mixin has a corresponding <dfn class="dfn-paneled" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="dfn" data-noexport id="windoworworkerglobalscope-task-scheduler">task scheduler</dfn>, which is initialized as a new <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①①">Scheduler</a></code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope①"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler" id="ref-for-scheduler①②"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler" id="ref-for-dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="attribute" data-export id="dom-windoworworkerglobalscope-scheduler"><code>scheduler</code></dfn> attribute’s getter steps are to return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a>'s <a data-link-type="dfn" href="#windoworworkerglobalscope-task-scheduler" id="ref-for-windoworworkerglobalscope-task-scheduler">task scheduler</a>.</p>
   <h4 class="heading settled" data-level="5.5.2" id="html-html-event-loop-definitions"><span class="secno">5.5.2. </span><span class="content"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">Event loop: definitions</a></span><a class="self-link" href="#html-html-event-loop-definitions"></a></h4>
   <p>Replace: For each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a>, every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source③">task source</a> must be associated with a specific <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue">task queue</a>.</p>
   <p>With: For each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop②">event loop</a>, every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source④">task source</a> **that is not a <a data-link-type="dfn" href="#scheduler-task-sources" id="ref-for-scheduler-task-sources">scheduler task source</a>** must be associated with a specific <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue①">task queue</a>.</p>
   <h4 class="heading settled" data-level="5.5.3" id="html-event-loop"><span class="secno">5.5.3. </span><span class="content"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">Event loop: processing model</a></span><a class="self-link" href="#html-event-loop"></a></h4>
   <p>Add the following steps to the event loop processing steps, before step 1:</p>
   <ol>
    <li data-md>
     <p>Let <var>queues</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">set</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop③">event loop</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue②">task queues</a> that
 contain at least one <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable②">runnable</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①">task</a>.</p>
    <li data-md>
     <p>Let <var>schedulers</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set④">set</a> of all <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①③">Scheduler</a></code> objects whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent" id="ref-for-relevant-agent">relevant agent’s</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop④">event loop</a> is this event loop and that <a data-link-type="dfn" href="#has-a-runnable-task" id="ref-for-has-a-runnable-task">have a runnable task</a>.</p>
    <li data-md>
     <p>If <var>schedulers</var> and <var>queues</var> are both <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">empty</a>, skip to the <code>microtasks</code> step below.</p>
   </ol>
   <p>Modify step 1 to read:</p>
   <ol>
    <li data-md>
     <p>Let <code>taskQueue</code> be one of the following:</p>
     <ol>
      <li data-md>
       <p>If <var>queues</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty②">empty</a>, one of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue③">task queues</a> in <var>queues</var>,
 chosen in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> manner.</p>
      <li data-md>
       <p>If <var>schedulers</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty③">empty</a>, the result of running the <a data-link-type="dfn" href="#select-the-task-queue-of-the-next-scheduler-task" id="ref-for-select-the-task-queue-of-the-next-scheduler-task">select the task queue of the next scheduler task</a> from one of the <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①④">Scheduler</a></code>s
 in <var>schedulers</var>, chosen in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> manner.</p>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="6" id="sec-security"><span class="secno">6. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#sec-security"></a></h2>
   <p><strong>TODO</strong>(shaseley): Fill this in.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-taskpriority-background">"background"</a><span>, in §2</span>
   <li><a href="#dom-taskcontroller-taskcontroller">constructor()</a><span>, in §3.2.1</span>
   <li><a href="#dom-taskcontroller-taskcontroller">constructor(priority)</a><span>, in §3.2.1</span>
   <li><a href="#create-a-scheduler-task-queue">create a scheduler task queue</a><span>, in §5.3</span>
   <li><a href="#create-a-scheduler-task-queue">creating a scheduler task queue</a><span>, in §5.3</span>
   <li><a href="#dom-schedulerposttaskoptions-delay">delay</a><span>, in §3.1</span>
   <li><a href="#scheduler-dynamic-priority-task-queue-map">dynamic priority task queue map</a><span>, in §4.3</span>
   <li><a href="#scheduler-task-enqueue-order">enqueue order</a><span>, in §4.1</span>
   <li><a href="#get-the-runnable-task-queues">get the runnable task queues</a><span>, in §5.4.3</span>
   <li><a href="#get-the-runnable-task-queues">getting the runnable task queues</a><span>, in §5.4.3</span>
   <li><a href="#taskpriority-greater-than">greater than</a><span>, in §2</span>
   <li><a href="#has-a-runnable-task">has a runnable task</a><span>, in §5.4.3</span>
   <li><a href="#has-a-runnable-task">have a runnable task</a><span>, in §5.4.3</span>
   <li><a href="#scheduler-next-enqueue-order">next enqueue order</a><span>, in §4.3</span>
   <li><a href="#scheduler-task-older-than">older than</a><span>, in §5.2</span>
   <li><a href="#dom-tasksignal-onprioritychange">onprioritychange</a><span>, in §3.2.2</span>
   <li><a href="#dom-scheduler-posttask">postTask(callback)</a><span>, in §5.4.2</span>
   <li><a href="#dom-scheduler-posttask">postTask(callback, options)</a><span>, in §5.4.2</span>
   <li>
    priority
    <ul>
     <li><a href="#dom-tasksignal-priority">attribute for TaskSignal</a><span>, in §3.2.2</span>
     <li><a href="#scheduler-task-queue-priority">dfn for scheduler task queue</a><span>, in §4.2</span>
     <li><a href="#dom-schedulerposttaskoptions-priority">dict-member for SchedulerPostTaskOptions</a><span>, in §3.1</span>
    </ul>
   <li><a href="#queue-a-scheduler-task">queue a scheduler task</a><span>, in §5.3</span>
   <li><a href="#queue-a-scheduler-task">queuing a scheduler task</a><span>, in §5.3</span>
   <li><a href="#scheduler-task-queue-remove">remove</a><span>, in §5.3</span>
   <li><a href="#schedule-a-task-to-invoke-a-callback">schedule a task to invoke a callback</a><span>, in §5.4.2</span>
   <li><a href="#scheduler">Scheduler</a><span>, in §3.1</span>
   <li><a href="#dom-windoworworkerglobalscope-scheduler">scheduler</a><span>, in §5.5.1</span>
   <li><a href="#callbackdef-schedulerposttaskcallback">SchedulerPostTaskCallback</a><span>, in §3.1</span>
   <li><a href="#dictdef-schedulerposttaskoptions">SchedulerPostTaskOptions</a><span>, in §3.1</span>
   <li><a href="#scheduler-task">scheduler task</a><span>, in §4.1</span>
   <li><a href="#scheduler-task-queue">scheduler task queue</a><span>, in §4.2</span>
   <li><a href="#scheduler-task-sources">scheduler task sources</a><span>, in §5.1</span>
   <li><a href="#select-the-scheduler-task-queue">selecting the scheduler task queue</a><span>, in §5.4.1</span>
   <li><a href="#select-the-task-queue-of-the-next-scheduler-task">selecting the task queue of the next scheduler task</a><span>, in §5.4.3</span>
   <li><a href="#select-the-scheduler-task-queue">select the scheduler task queue</a><span>, in §5.4.1</span>
   <li><a href="#select-the-task-queue-of-the-next-scheduler-task">select the task queue of the next scheduler task</a><span>, in §5.4.3</span>
   <li><a href="#dom-taskcontroller-setpriority">setPriority(priority)</a><span>, in §3.2.1</span>
   <li><a href="#dom-schedulerposttaskoptions-signal">signal</a><span>, in §3.1</span>
   <li><a href="#scheduler-static-priority-task-queue-map">static priority task queue map</a><span>, in §4.3</span>
   <li><a href="#taskcontroller">TaskController</a><span>, in §3.2.1</span>
   <li><a href="#dom-taskcontroller-taskcontroller">TaskController()</a><span>, in §3.2.1</span>
   <li><a href="#dom-taskcontroller-taskcontroller">TaskController(priority)</a><span>, in §3.2.1</span>
   <li><a href="#enumdef-taskpriority">TaskPriority</a><span>, in §2</span>
   <li><a href="#scheduler-task-queue-tasks">tasks</a><span>, in §4.2</span>
   <li><a href="#windoworworkerglobalscope-task-scheduler">task scheduler</a><span>, in §5.5.1</span>
   <li><a href="#tasksignal">TaskSignal</a><span>, in §3.2.2</span>
   <li><a href="#the-posted-task-task-source">The posted task task source</a><span>, in §5.1</span>
   <li><a href="#dom-taskpriority-user-blocking">"user-blocking"</a><span>, in §2</span>
   <li><a href="#dom-taskpriority-user-visible">"user-visible"</a><span>, in §2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-abortcontroller">
   <a href="https://dom.spec.whatwg.org/#abortcontroller">https://dom.spec.whatwg.org/#abortcontroller</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortcontroller">3.2.1. TaskController</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal">
   <a href="https://dom.spec.whatwg.org/#abortsignal">https://dom.spec.whatwg.org/#abortsignal</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal">3.1. Scheduling Tasks</a>
    <li><a href="#ref-for-abortsignal①">3.2.2. TaskSignal</a>
    <li><a href="#ref-for-abortsignal②">5.4.1. Selecting the Task Queue</a>
    <li><a href="#ref-for-abortsignal③">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-aborted-flag">
   <a href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag">https://dom.spec.whatwg.org/#abortsignal-aborted-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-aborted-flag">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-add">
   <a href="https://dom.spec.whatwg.org/#abortsignal-add">https://dom.spec.whatwg.org/#abortsignal-add</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-add">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">3.2.2. TaskSignal</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-windoworworkerglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windoworworkerglobalscope">5.5.1. WindowOrWorkerGlobalScope</a> <a href="#ref-for-windoworworkerglobalscope①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-document">https://html.spec.whatwg.org/multipage/webappapis.html#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document①">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-loop">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#event-loop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-loop">4.3. Scheduler</a>
    <li><a href="#ref-for-event-loop①">5.5.2. Event loop: definitions</a> <a href="#ref-for-event-loop②">(2)</a>
    <li><a href="#ref-for-event-loop③">5.5.3. Event loop: processing model</a> <a href="#ref-for-event-loop④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-agent">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-agent">5.5.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task-runnable">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task-runnable">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-concept-task-runnable①">(2)</a>
    <li><a href="#ref-for-concept-task-runnable②">5.5.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-script-evaluation-environment-settings-object-set">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set">https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-script-evaluation-environment-settings-object-set">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-source">https://html.spec.whatwg.org/multipage/webappapis.html#concept-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-source">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task-steps">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task-steps">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task">4.1. Scheduler Tasks</a>
    <li><a href="#ref-for-concept-task①">5.5.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-queue">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-queue">5.5.2. Event loop: definitions</a> <a href="#ref-for-task-queue①">(2)</a>
    <li><a href="#ref-for-task-queue②">5.5.3. Event loop: processing model</a> <a href="#ref-for-task-queue③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-source">5.1. Scheduler Task Sources</a> <a href="#ref-for-task-source①">(2)</a>
    <li><a href="#ref-for-task-source②">5.3. Scheduler Task Queue Algorithms</a>
    <li><a href="#ref-for-task-source③">5.5.2. Event loop: definitions</a> <a href="#ref-for-task-source④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-map-exists①">(2)</a>
    <li><a href="#ref-for-map-exists②">5.4.2. Scheduling Tasks</a> <a href="#ref-for-map-exists③">(2)</a> <a href="#ref-for-map-exists④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-empty">
   <a href="https://infra.spec.whatwg.org/#list-empty">https://infra.spec.whatwg.org/#list-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-empty">5.4.3. Selecting the Next Task To Run</a>
    <li><a href="#ref-for-list-empty①">5.5.3. Event loop: processing model</a> <a href="#ref-for-list-empty②">(2)</a> <a href="#ref-for-list-empty③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-map-exists①">(2)</a>
    <li><a href="#ref-for-map-exists②">5.4.2. Scheduling Tasks</a> <a href="#ref-for-map-exists③">(2)</a> <a href="#ref-for-map-exists④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-extend">
   <a href="https://infra.spec.whatwg.org/#list-extend">https://infra.spec.whatwg.org/#list-extend</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-extend">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-getting-the-values">
   <a href="https://infra.spec.whatwg.org/#map-getting-the-values">https://infra.spec.whatwg.org/#map-getting-the-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-getting-the-values">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-map-getting-the-values①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-implementation-defined">
   <a href="https://infra.spec.whatwg.org/#implementation-defined">https://infra.spec.whatwg.org/#implementation-defined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implementation-defined">5.5.3. Event loop: processing model</a> <a href="#ref-for-implementation-defined①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct-item">
   <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct-item">4.1. Scheduler Tasks</a>
    <li><a href="#ref-for-struct-item①">4.2. Scheduler Task Queues</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2. Task Priorities</a>
    <li><a href="#ref-for-ordered-map①">4.3. Scheduler</a> <a href="#ref-for-ordered-map②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-remove">
   <a href="https://infra.spec.whatwg.org/#list-remove">https://infra.spec.whatwg.org/#list-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-remove">5.3. Scheduler Task Queue Algorithms</a>
    <li><a href="#ref-for-list-remove①">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">4.2. Scheduler Task Queues</a>
    <li><a href="#ref-for-ordered-set①">5.3. Scheduler Task Queue Algorithms</a> <a href="#ref-for-ordered-set②">(2)</a>
    <li><a href="#ref-for-ordered-set③">5.5.3. Event loop: processing model</a> <a href="#ref-for-ordered-set④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">4.2. Scheduler Task Queues</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-aborterror">
   <a href="https://heycam.github.io/webidl/#aborterror">https://heycam.github.io/webidl/#aborterror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-aborterror">5.4.2. Scheduling Tasks</a> <a href="#ref-for-aborterror①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">5.4.2. Scheduling Tasks</a> <a href="#ref-for-idl-DOMException①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">3.1. Scheduling Tasks</a>
    <li><a href="#ref-for-Exposed①">3.2.1. TaskController</a>
    <li><a href="#ref-for-Exposed②">3.2.2. TaskSignal</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://heycam.github.io/webidl/#idl-promise">https://heycam.github.io/webidl/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">3.1. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
   <a href="https://heycam.github.io/webidl/#a-promise-rejected-with">https://heycam.github.io/webidl/#a-promise-rejected-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-rejected-with">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-any">
   <a href="https://heycam.github.io/webidl/#idl-any">https://heycam.github.io/webidl/#idl-any</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-any">3.1. Scheduling Tasks</a> <a href="#ref-for-idl-any①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invoke-a-callback-function">
   <a href="https://heycam.github.io/webidl/#invoke-a-callback-function">https://heycam.github.io/webidl/#invoke-a-callback-function</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invoke-a-callback-function">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-long">
   <a href="https://heycam.github.io/webidl/#idl-long">https://heycam.github.io/webidl/#idl-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-long">3.1. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">5.4.2. Scheduling Tasks</a> <a href="#ref-for-this①">(2)</a> <a href="#ref-for-this②">(3)</a>
    <li><a href="#ref-for-this③">5.5.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://heycam.github.io/webidl/#idl-undefined">https://heycam.github.io/webidl/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">3.2.1. TaskController</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-abortcontroller">AbortController</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal">AbortSignal</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-aborted-flag">aborted flag</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-add">add</span>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document①">document</span>
     <li><span class="dfn-paneled" id="term-for-event-loop">event loop</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-relevant-agent">relevant agent</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-concept-task-runnable">runnable</span>
     <li><span class="dfn-paneled" id="term-for-script-evaluation-environment-settings-object-set">script evaluation environment settings object set</span>
     <li><span class="dfn-paneled" id="term-for-concept-source">source</span>
     <li><span class="dfn-paneled" id="term-for-concept-task-steps">steps</span>
     <li><span class="dfn-paneled" id="term-for-concept-task">task</span>
     <li><span class="dfn-paneled" id="term-for-task-queue">task queues</span>
     <li><span class="dfn-paneled" id="term-for-task-source">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-set-append">append</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">contain</span>
     <li><span class="dfn-paneled" id="term-for-list-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-map-exists①">exist</span>
     <li><span class="dfn-paneled" id="term-for-list-extend">extend</span>
     <li><span class="dfn-paneled" id="term-for-map-getting-the-values">get the values</span>
     <li><span class="dfn-paneled" id="term-for-implementation-defined">implementation-defined</span>
     <li><span class="dfn-paneled" id="term-for-struct-item">item</span>
     <li><span class="dfn-paneled" id="term-for-list-iterate">iterate</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
     <li><span class="dfn-paneled" id="term-for-list-remove">remove</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">set</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-aborterror">AbortError</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">a promise rejected with</span>
     <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
     <li><span class="dfn-paneled" id="term-for-invoke-a-callback-function">invoke</span>
     <li><span class="dfn-paneled" id="term-for-idl-long">long</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></a> {
    <a href="#dom-taskpriority-user-blocking"><code><c- s>"user-blocking"</c-></code></a>,
    <a href="#dom-taskpriority-user-visible"><code><c- s>"user-visible"</c-></code></a>,
    <a href="#dom-taskpriority-background"><code><c- s>"background"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></a> {
    (<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#tasksignal"><c- n>TaskSignal</c-></a>)? <a data-default="null" data-type="(AbortSignal or TaskSignal)? " href="#dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></a> = <c- b>null</c->;
    <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a>? <a data-default="null" data-type="TaskPriority? " href="#dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></a> = <c- b>null</c->;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long"><c- b>long</c-></a> <a data-default="0" data-type="long " href="#dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></a> = 0;
};

<c- b>callback</c-> <a href="#callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)] <c- b>interface</c-> <a href="#scheduler"><code><c- g>Scheduler</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <a href="#dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <a href="#dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code></a> = {});
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)] <c- b>interface</c-> <a href="#taskcontroller"><code><c- g>TaskController</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller"><c- n>AbortController</c-></a> {
  <a href="#dom-taskcontroller-taskcontroller"><code><c- g>constructor</c-></code></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a href="#dom-taskcontroller-taskcontroller-priority-priority"><code><c- g>priority</c-></code></a> = "user-visible");
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a> <a href="#dom-taskcontroller-setpriority"><code><c- g>setPriority</c-></code></a>(<a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a href="#dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)] <c- b>interface</c-> <a href="#tasksignal"><code><c- g>TaskSignal</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-readonly data-type="TaskPriority" href="#dom-tasksignal-priority"><code><c- g>priority</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-tasksignal-onprioritychange"><code><c- g>onprioritychange</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Is that the right way to define signal?<a href="#issue-5c5aa461"> ↵ </a></div>
   <div class="issue"> Should we refactor the event loop task creation code and remove the duplicatation?<a href="#issue-78a65b9e"> ↵ </a></div>
   <div class="issue"> Link the priority change algorithm.<a href="#issue-75aafb43"> ↵ </a></div>
   <div class="issue"> Parts of this need to be atomic, but how do we do that?<a href="#issue-4bae1ee2"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="enumdef-taskpriority">
   <b><a href="#enumdef-taskpriority">#enumdef-taskpriority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-taskpriority">2. Task Priorities</a> <a href="#ref-for-enumdef-taskpriority①">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority②">3.1. Scheduling Tasks</a>
    <li><a href="#ref-for-enumdef-taskpriority③">3.2.1. TaskController</a> <a href="#ref-for-enumdef-taskpriority④">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority⑤">3.2.2. TaskSignal</a>
    <li><a href="#ref-for-enumdef-taskpriority⑥">4.2. Scheduler Task Queues</a>
    <li><a href="#ref-for-enumdef-taskpriority⑦">4.3. Scheduler</a> <a href="#ref-for-enumdef-taskpriority⑧">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority⑨">5.3. Scheduler Task Queue Algorithms</a>
    <li><a href="#ref-for-enumdef-taskpriority①⓪">5.4.1. Selecting the Task Queue</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-user-blocking">
   <b><a href="#dom-taskpriority-user-blocking">#dom-taskpriority-user-blocking</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-user-blocking">2. Task Priorities</a> <a href="#ref-for-dom-taskpriority-user-blocking①">(2)</a> <a href="#ref-for-dom-taskpriority-user-blocking②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-user-visible">
   <b><a href="#dom-taskpriority-user-visible">#dom-taskpriority-user-visible</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-user-visible">2. Task Priorities</a> <a href="#ref-for-dom-taskpriority-user-visible①">(2)</a> <a href="#ref-for-dom-taskpriority-user-visible②">(3)</a>
    <li><a href="#ref-for-dom-taskpriority-user-visible③">5.4.1. Selecting the Task Queue</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-background">
   <b><a href="#dom-taskpriority-background">#dom-taskpriority-background</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-background">2. Task Priorities</a> <a href="#ref-for-dom-taskpriority-background①">(2)</a> <a href="#ref-for-dom-taskpriority-background②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="taskpriority-greater-than">
   <b><a href="#taskpriority-greater-than">#taskpriority-greater-than</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-taskpriority-greater-than">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-schedulerposttaskoptions">
   <b><a href="#dictdef-schedulerposttaskoptions">#dictdef-schedulerposttaskoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-schedulerposttaskoptions">3.1. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-signal">
   <b><a href="#dom-schedulerposttaskoptions-signal">#dom-schedulerposttaskoptions-signal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-signal">5.4.2. Scheduling Tasks</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-priority">
   <b><a href="#dom-schedulerposttaskoptions-priority">#dom-schedulerposttaskoptions-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-priority">5.4.2. Scheduling Tasks</a> <a href="#ref-for-dom-schedulerposttaskoptions-priority①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-delay">
   <b><a href="#dom-schedulerposttaskoptions-delay">#dom-schedulerposttaskoptions-delay</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-delay">5.4.2. Scheduling Tasks</a> <a href="#ref-for-dom-schedulerposttaskoptions-delay①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-schedulerposttaskcallback">
   <b><a href="#callbackdef-schedulerposttaskcallback">#callbackdef-schedulerposttaskcallback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-schedulerposttaskcallback">3.1. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler">
   <b><a href="#scheduler">#scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler">2. Task Priorities</a>
    <li><a href="#ref-for-scheduler①">4.3. Scheduler</a> <a href="#ref-for-scheduler②">(2)</a> <a href="#ref-for-scheduler③">(3)</a> <a href="#ref-for-scheduler④">(4)</a> <a href="#ref-for-scheduler⑤">(5)</a>
    <li><a href="#ref-for-scheduler⑥">5.4.1. Selecting the Task Queue</a>
    <li><a href="#ref-for-scheduler⑦">5.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-scheduler⑧">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-scheduler⑨">(2)</a> <a href="#ref-for-scheduler①⓪">(3)</a>
    <li><a href="#ref-for-scheduler①①">5.5.1. WindowOrWorkerGlobalScope</a> <a href="#ref-for-scheduler①②">(2)</a>
    <li><a href="#ref-for-scheduler①③">5.5.3. Event loop: processing model</a> <a href="#ref-for-scheduler①④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal">
   <b><a href="#tasksignal">#tasksignal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal">3.1. Scheduling Tasks</a>
    <li><a href="#ref-for-tasksignal①">4.3. Scheduler</a>
    <li><a href="#ref-for-tasksignal②">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-tasksignal③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-tasksignal-priority">
   <b><a href="#dom-tasksignal-priority">#dom-tasksignal-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-tasksignal-priority">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-dom-tasksignal-priority①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task">
   <b><a href="#scheduler-task">#scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task">4.2. Scheduler Task Queues</a>
    <li><a href="#ref-for-scheduler-task①">5.1. Scheduler Task Sources</a>
    <li><a href="#ref-for-scheduler-task②">5.2. Scheduler Task Algorithms</a> <a href="#ref-for-scheduler-task③">(2)</a>
    <li><a href="#ref-for-scheduler-task④">5.3. Scheduler Task Queue Algorithms</a> <a href="#ref-for-scheduler-task⑤">(2)</a>
    <li><a href="#ref-for-scheduler-task⑥">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-scheduler-task⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-enqueue-order">
   <b><a href="#scheduler-task-enqueue-order">#scheduler-task-enqueue-order</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-enqueue-order">5.2. Scheduler Task Algorithms</a> <a href="#ref-for-scheduler-task-enqueue-order①">(2)</a>
    <li><a href="#ref-for-scheduler-task-enqueue-order②">5.3. Scheduler Task Queue Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue">
   <b><a href="#scheduler-task-queue">#scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue">4.3. Scheduler</a> <a href="#ref-for-scheduler-task-queue①">(2)</a> <a href="#ref-for-scheduler-task-queue②">(3)</a>
    <li><a href="#ref-for-scheduler-task-queue③">5.3. Scheduler Task Queue Algorithms</a> <a href="#ref-for-scheduler-task-queue④">(2)</a> <a href="#ref-for-scheduler-task-queue⑤">(3)</a>
    <li><a href="#ref-for-scheduler-task-queue⑥">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-priority">
   <b><a href="#scheduler-task-queue-priority">#scheduler-task-queue-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-priority">5.3. Scheduler Task Queue Algorithms</a>
    <li><a href="#ref-for-scheduler-task-queue-priority①">5.4.1. Selecting the Task Queue</a>
    <li><a href="#ref-for-scheduler-task-queue-priority②">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-scheduler-task-queue-priority③">(2)</a> <a href="#ref-for-scheduler-task-queue-priority④">(3)</a> <a href="#ref-for-scheduler-task-queue-priority⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-tasks">
   <b><a href="#scheduler-task-queue-tasks">#scheduler-task-queue-tasks</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-tasks">5.3. Scheduler Task Queue Algorithms</a> <a href="#ref-for-scheduler-task-queue-tasks①">(2)</a> <a href="#ref-for-scheduler-task-queue-tasks②">(3)</a>
    <li><a href="#ref-for-scheduler-task-queue-tasks③">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-scheduler-task-queue-tasks④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-static-priority-task-queue-map">
   <b><a href="#scheduler-static-priority-task-queue-map">#scheduler-static-priority-task-queue-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-static-priority-task-queue-map">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-scheduler-static-priority-task-queue-map①">(2)</a> <a href="#ref-for-scheduler-static-priority-task-queue-map②">(3)</a>
    <li><a href="#ref-for-scheduler-static-priority-task-queue-map③">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-dynamic-priority-task-queue-map">
   <b><a href="#scheduler-dynamic-priority-task-queue-map">#scheduler-dynamic-priority-task-queue-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-dynamic-priority-task-queue-map">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-scheduler-dynamic-priority-task-queue-map①">(2)</a> <a href="#ref-for-scheduler-dynamic-priority-task-queue-map②">(3)</a>
    <li><a href="#ref-for-scheduler-dynamic-priority-task-queue-map③">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-next-enqueue-order">
   <b><a href="#scheduler-next-enqueue-order">#scheduler-next-enqueue-order</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-next-enqueue-order">4.3. Scheduler</a> <a href="#ref-for-scheduler-next-enqueue-order①">(2)</a>
    <li><a href="#ref-for-scheduler-next-enqueue-order②">5.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler-next-enqueue-order③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-sources">
   <b><a href="#scheduler-task-sources">#scheduler-task-sources</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-sources">5.5.2. Event loop: definitions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="the-posted-task-task-source">
   <b><a href="#the-posted-task-task-source">#the-posted-task-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-posted-task-task-source">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-older-than">
   <b><a href="#scheduler-task-older-than">#scheduler-task-older-than</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-older-than">5.4.3. Selecting the Next Task To Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-scheduler-task-queue">
   <b><a href="#create-a-scheduler-task-queue">#create-a-scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-scheduler-task-queue">5.4.1. Selecting the Task Queue</a> <a href="#ref-for-create-a-scheduler-task-queue①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="queue-a-scheduler-task">
   <b><a href="#queue-a-scheduler-task">#queue-a-scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-scheduler-task">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-remove">
   <b><a href="#scheduler-task-queue-remove">#scheduler-task-queue-remove</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-remove">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="select-the-scheduler-task-queue">
   <b><a href="#select-the-scheduler-task-queue">#select-the-scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-select-the-scheduler-task-queue">5.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-scheduler-posttask">
   <b><a href="#dom-scheduler-posttask">#dom-scheduler-posttask</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-scheduler-posttask">3.1. Scheduling Tasks</a>
    <li><a href="#ref-for-dom-scheduler-posttask①">5.1. Scheduler Task Sources</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="schedule-a-task-to-invoke-a-callback">
   <b><a href="#schedule-a-task-to-invoke-a-callback">#schedule-a-task-to-invoke-a-callback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-schedule-a-task-to-invoke-a-callback">5.4.2. Scheduling Tasks</a> <a href="#ref-for-schedule-a-task-to-invoke-a-callback①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="get-the-runnable-task-queues">
   <b><a href="#get-the-runnable-task-queues">#get-the-runnable-task-queues</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-get-the-runnable-task-queues">5.4.3. Selecting the Next Task To Run</a> <a href="#ref-for-get-the-runnable-task-queues①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="has-a-runnable-task">
   <b><a href="#has-a-runnable-task">#has-a-runnable-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-has-a-runnable-task">5.5.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="select-the-task-queue-of-the-next-scheduler-task">
   <b><a href="#select-the-task-queue-of-the-next-scheduler-task">#select-the-task-queue-of-the-next-scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-select-the-task-queue-of-the-next-scheduler-task">5.5.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="windoworworkerglobalscope-task-scheduler">
   <b><a href="#windoworworkerglobalscope-task-scheduler">#windoworworkerglobalscope-task-scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windoworworkerglobalscope-task-scheduler">5.5.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windoworworkerglobalscope-scheduler">
   <b><a href="#dom-windoworworkerglobalscope-scheduler">#dom-windoworworkerglobalscope-scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windoworworkerglobalscope-scheduler">5.5.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>